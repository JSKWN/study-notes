PostgreSQL 준비 (오픈소스 DB)

Azure는 MySQL, MariaDB, PostgreSQL 등의 상용 DBMS 및 CosmosDB 등의 클라우드 DBMS도 지원함. 

![[image-26.png]]

PostgreSQL 전용 DB를 만들기 위해, 검색 바에서 postgresql을 검색하여 “Azure Database for PostgreSQL 유연한 서버” 항목 선택

‘만들기’ 버튼 클릭 후 DB생성

## 기본 탭
기본 탭에서는 VM 생성과 유사하게, 프로젝트 세부 정보, 서버 정보, 고야용성, 인증 등 DBMS 서버에 대한 시스템 정보를 설정
![[image-27.png]]
- 프로젝트 세부 정보 영역: 리소스 그룹 설정 (리소스 그룹이란 Azure 상에서 개발될 서비스의 리소스들을 묶는 논리적 개념)
	- VM생성시 작성한 ‘KNOU_MALL’을 선택함
- 서버 정보 영역
	- 서버 이름: DBMS가 구동되는 VM의 호스트 이름을 결정.
	- 지역: VM이 생성될 지역.
	- PostgreSQL 버전
	- 워크로드 유형: 생성하려는 DBMS의 처리량에 대한 정도를 지정.
		- 프로덕션 옵션을 선택할 경우, DBMS의 컴퓨팅 및 스토리지 용량을 선택할 수 있으나, 최소한의 비용을 위해 개발/테스트 선택
	- 가용성 영역: 데이터 센터 내 다른 영역에 DBMS 서버를 복제하여 서비스의 연속성을 확보할 때 사용 (실습 시에는 ‘기본 설정 없음’을 선택)

![[image-28.png]]
- 인증: PostgreSQL 서버에 접속하기 위한 계정 정보를 입력
	- Microsoft Entra 인증(=클라우드 기반의 디지털 신분증 관리소)은, 리소스에 다수의 사용자가 접근해야 할 경우, 일괄적으로 관리하기 위해 계정 정보 및 컴퓨터 정보, 관리 정책에 대한 정보를 저장하고 있는 일종의 DB
		- 통합 로그인 (SSO - Single Sign-On): 아이디 하나로 여러 개의 앱에 한번에 로그인 할 수 있도록
		- 다단계 인증 (MFA): 비밀번호 외에 스마트폰 앱이나 문자로 한 번 더 본인 인증
		- 조건부 액세스: "회사 사무실 IP에서만 접속 허용" 또는 "바이러스 없는 PC에서만 접속 허용" 같이 특정 조건
		- ID 관리: 입사 시 계정을 생성하고, 퇴사 시 자동으로 접근 권한을 차단하는 등의 관리
	- 실습 시에는 PostgreSQL 인증만 사용


## 네트워킹

네트워킹 단계는 PostgreSQL DB로 접속하거나 PostgreSQL DB와 가상네트워크 외부의 호스트간의 연결을 설정
![[image-29.png]]
- 네트워크 연결
	- 공용 액세스: 가상 네트워크 말고, 외부에서도 접속 허용하게 하려면 선택
	- 프라이빗 액세스: Azure 내부에서 구성된 가상 네트워크만 연결을 허용
	- 실습 시에는 외부에서도 접근 되어야 하므로 공용(퍼블릭) 액세스 설정

## 보안 탭
PostgreSQL DB에 “저장되는 데이터”를 Azure 클라우드 환경 내에서 저장할 때 암호화 방법을 지정. 퍼블릭 클라우드는 여러 사용자와 공유하는 모델이기 때문에, 저장되는 데이터가 지정된 암호화 키에 의해 암호화되어 저장될 필요가 있음. Azure가 생성하는 것을 사용하거나, 사용자가 직접 키를 생성하여 등록, 사용할 수 있음
![[image-30.png]]
- 실습에서는 Azure가 직접 생성하는 ‘서비스 관리형 키’를 사용

## 배포 완료 - 개요
![[image-33.png]]



## (배포 후) 네트워킹 설정
- 공용 액세스를 허용했더라도, 방화벽으로 인해 접속이 제한될 수 있음.
- DB 서버에 접속하여 스키마, 프로시저 작성 등의 작업을 위해서는 현재 사용중인 PC에서 서버로 접속할 수 있어야 함.
- PostgreSQL은 DBeaver라는 DB 관리 도구를 다운받아 활용 (다양한 DB를 하나의 툴에서 관리할 수 있는 관리도구)
![[image-35.png]]
- Azure 서비스간 접근 허용을 위해 ‘Azure 내의 모든 Azure 서비스의 이 서버에 대한 퍼블릭 액세스 허용’옵션을 사용
- ‘현재 클라이언트 IP 주소 추가’를 클릭하여 방화벽 규칙 추가

## 데이터베이스 생성
설정 - 데이터베이스 탭에서 사용할 PostgreSQL 데이터베이스를 생성함. 해당 데이터베이스 이름을 이용하여 PostgreSQL에 접속
![[image-36.png]]
## DBeaver 연결 설정

![[image-32.png]]

- DBeaver 실행 후, 플러그 모양 아이콘의 ‘새 DB 연결’을 클릭한 후 PostgreSQL을 선택

![[image-37.png]]
- Azure에서 생성한 DB의 서버 이름(엔트포인트)와 관리자 ID/PW를 이용하여 연결

![[image-39.png]]
- 연결 성공 후, 상단 메뉴바에서 SQL 버튼 클릭 (SQL 편집기)


![[image-41.png]]
스크립트 작성 완료 후, 왼쪽의 작은 ‘SQL 스크립트 실행(세번째 항목)’ 아이콘 클릭 → 6개의 테이블이 생성된 것을 확인 가능 (Table 폴더 우클릭 후 새로고침 할 것)

![[image-42.png]]

‘Table 우클릭 - 다이어그램 보기’를 이용해 ER 다이어그램 확인 가능

