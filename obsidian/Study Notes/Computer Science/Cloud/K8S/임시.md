

# K8S ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œÂ **ì„¤ì¹˜í•˜ê¸°**


Jul 25, 2023

[
ì¸í”„ë¼ë‚˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ì˜ ëª¨ë¥´ëŠ” ê°œë°œìê°€ zeroì—ì„œë¶€í„° ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì„ êµ¬ì¶•í•œ ìš°ë‹¹íƒ•íƒ• êµ¬ì¶•ê¸°ì…ë‹ˆë‹¤.

í•´ë‹¹ ê¸€ì€ ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œ ì–´ë–¤ ë„êµ¬ë¥¼ ì„ íƒí•´ì•¼ í•˜ëŠ”ì§€ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.

![](https://miro.medium.com/v2/resize:fit:640/0*1636LEaPmwgD0-SN.png)

## ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì„ ì„ íƒí•œ ì´ìœ 

ì¼ë°˜ì ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°ì—ëŠ” Amazon EKSë‚˜ Azure AKSì™€ ê°™ì€ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•˜ì§€ë§Œ, ì´ëŸ° ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ì¶”ê°€ì ì¸ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.

ë˜í•œ í˜„ì¬ íšŒì‚¬ì—ì„œ ìš´ì˜ì¤‘ì¸ ì¸í”„ë¼ê°€ ê¸°ì¡´ IDCë¥¼ í™œìš©í•˜ê³  ìˆì–´ì„œ, ë‘ê°€ì§€ ë¯¸ì…˜ì„ ê°–ê³  êµ¬ì¶•í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

- ë¹„ìš© ì ˆê°
- ê¸°ì¡´ ì¸í”„ë¼ í™œìš©

ë”°ë¼ì„œ, ë¹„ìš©ì ì¸ ì œì•½ì´ ìˆëŠ” ìƒí™©ì—ì„œëŠ” ì§ì ‘ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì´ ë”ìš± í•©ë¦¬ì ì¼ ìˆ˜ ìˆë‹¤ê³  íŒë‹¨ì´ ë“¤ì–´ì„œ êµ¬ê¸€ë§ì„ í•˜ê¸° ì‹œì‘í–ˆê³ , ì‹¤ì œ ì—¬ëŸ¬ê°€ì§€ ì˜¤í”ˆì†ŒìŠ¤ ë„êµ¬ë“¤ì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

## í´ëŸ¬ìŠ¤í„° êµ¬ì¶•ì„ ìœ„í•œ ë°°í¬ ë„êµ¬

ì§ì ‘ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” ë°°í¬ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì—¬ê¸°ì—ëŠ” Kubeadm, Kops, Kubespray ë“±ì´ ìˆìŠµë‹ˆë‹¤.

- Kubeadm
- Kops
- Kubespray

( ì°¸ê³ :Â [ë°°í¬ ë„êµ¬ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜í•˜ê¸°](https://kubernetes.io/ko/docs/setup/production-environment/tools/)Â )

ì´ì¤‘ì—ì„œ IDCì™€ ê°™ì€ ì¼ë°˜ì ì¸ ë¦¬ëˆ…ìŠ¤ í™˜ê²½ ì„œë²„, ë² ì–´ë©”íƒˆ ì§€ì›ì„ í•´ì£¼ëŠ” Kubespray ì„ ì±„íƒí•˜ì˜€ìŠµë‹ˆë‹¤.

## Kubesprayì˜ íŠ¹ì§• ë° ì¥ì 

KubesprayëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì‰½ê²Œ ì„¤ì¹˜í•´ì£¼ëŠ” ìë™í™” ë„êµ¬ì…ë‹ˆë‹¤. Ansibleì˜ Playbookê³¼ inventory ì„¤ì •ì„ í†µí•´ í´ëŸ¬ìŠ¤í„°ë§ ì„¤ì •ì„ ì†ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤ë‹ˆë‹¤.

> **Kubesprayì˜ íŠ¹ì§•:**Â ê³ ê°€ìš©ì„± í´ëŸ¬ìŠ¤í„°, ë¦¬ëˆ…ìŠ¤ ë°°í¬íŒ ì§€ì›, ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ ì„ íƒ, ì§€ì†ì ì¸ í†µí•© (CI) í…ŒìŠ¤íŠ¸

ë˜í•œ, KubesprayëŠ” ê³ ê°€ìš©ì„±ì„ ì§€ë‹Œ í´ëŸ¬ìŠ¤í„°, ëŒ€ë¶€ë¶„ì˜ ì¸ê¸° ìˆëŠ” ë¦¬ëˆ…ìŠ¤ ë°°í¬íŒë“¤ì— ëŒ€í•œ ì§€ì›, ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì„ ì„ íƒí•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ êµ¬ì„±í•˜ëŠ” ë“±ì˜ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.

## Kubespray ê¸°ë°˜ í´ëŸ¬ìŠ¤í„° ì„¤ì¹˜í•˜ê¸°

### **ìš”êµ¬ì‚¬í•­**

- Kubernetes >= v1.24
- Ansible v2.11+, Jinja 2.11+ ë° python-netaddrì´ Ansible ëª…ë ¹ì„ ì‹¤í–‰í•  ì‹œìŠ¤í…œì— ì„¤ì¹˜ë©ë‹ˆë‹¤
- IPv4 forwarding
- Memory â€” Master: 1500 MB
- Memory â€” Node: 1024 MB

### ì‚¬ì „ ì¤€ë¹„

Kubesprayë¥¼ ì´ìš©í•œ í´ëŸ¬ìŠ¤í„° êµ¬ì¶•ì„ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì¤€ë¹„ê°€ ë˜ì–´ ìˆì–´ì•¼í•©ë‹ˆë‹¤

## GetÂ BLUECHEAT ğŸ§¢â€™s stories inÂ yourÂ inbox

Join Medium for free to get updates fromÂ thisÂ writer.

Subscribe

**1. Python3 ë° Ansible ì„¤ì¹˜**

# íŒŒì´ì¬ ì„¤ì¹˜  
apt update -y  
apt install -y python3  
apt install -y python3-pip

**2. kubespray ìŠ¤í¬ë¦½íŠ¸ ì´ˆê¸° ì„¸íŒ…**

# ìŠ¤í¬ë¦½íŠ¸ ë‹¤ìš´ë¡œë“œ  
git clone https://github.com/kubernetes-sigs/kubespray.git  
  
cd kubespray/  
# ì£¼ì˜ ì›í•˜ëŠ” ë²„ì „ìœ¼ë¡œ ë³€ê²½ í•„ìš”  
git checkout -b v2.16  
sudo pip3 install -r requirements.txt   
  
# sample íŒŒì¼ì„ custom cluster í´ë”ì— ë³µì‚¬í•©ë‹ˆë‹¤.

**3. ì„¸íŒ…ì„ í•œë’¤ ansible ping ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤**

ansible all -i inventory.ini -m ping --become

## í´ëŸ¬ìŠ¤í„° êµ¬ì¶•

### 1. í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•  ì„œë²„ í™˜ê²½ ì¤€ë¹„

ë¨¼ì €, ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•  ì„œë²„ë“¤ì˜ í™˜ê²½ì„ ì¤€ë¹„í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œëŠ” ì„œë²„ ê°„ì˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸ê³¼ ë°©í™”ë²½ ì„¤ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

- ì„œë²„ ê°„ ì—°ê²° í™•ì¸: í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ëŠ” ëª¨ë“  ì„œë²„ë“¤ ê°„ì—ëŠ” ì •ìƒì ì¸ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ì´ë£¨ì–´ì ¸ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì„œë²„ ê°„ ì—°ê²°ì´ ì›í™œí•œì§€ í™•ì¸í•˜ëŠ” ì ˆì°¨ë¥¼ ê±°ì³ì£¼ì„¸ìš”.
- ë°©í™”ë²½ ì„¤ì •: í´ëŸ¬ìŠ¤í„°ë¡œ êµ¬ì„±í•  ì„œë²„ ê°„ì˜ ë°©í™”ë²½ ì„¤ì •ì€ ì‚¬ìš©ìê°€ ì§ì ‘ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. Kubernetesì˜ ë°©í™”ë²½ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ë„ë¡ ì„¤ì •ì„ í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤. ë°©í™”ë²½ ì„¤ì • ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€Â [_IBM ë¬¸ì„œ_](https://www.ibm.com/docs/en/SSCKRH_1.4.0/platform/req_network.html?locale=en-US#firewall_req)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### 2. ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° êµ¬ì¶•

ì„œë²„ í™˜ê²½ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ìë™ìœ¼ë¡œ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ansible-playbook -i inventory/mycluster/inventory.ini --become --become-user=root cluster.yml

ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´, ì„¤ì •í•œ ì¸ë²¤í† ë¦¬ ì •ë³´ì— ë”°ë¼ì„œ ìë™ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ê°€ êµ¬ì¶•ë©ë‹ˆë‹¤.

### 3. ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë…¸ë“œ ì¶”ê°€

ê¸°ì¡´ í´ëŸ¬ìŠ¤í„°ì— ìƒˆë¡œìš´ ë¬¼ë¦¬ì ì¸ ì„œë²„ë¥¼ ì¶”ê°€í•˜ë ¤ë©´, ë‹¤ìŒê³¼ ê°™ì´ í´ëŸ¬ìŠ¤í„° Scale ì‘ì—…ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

ansible-playbook -i inventory/mycluster/inventory.ini --become --become-user=root scale.yml

ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´, ê¸°ì¡´ í´ëŸ¬ìŠ¤í„°ì— ìƒˆë¡œìš´ ë…¸ë“œê°€ ì¶”ê°€ë©ë‹ˆë‹¤.

### 4. ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë…¸ë“œ ì‚­ì œ

í´ëŸ¬ìŠ¤í„°ì—ì„œ íŠ¹ì • ë…¸ë“œë¥¼ ì‚­ì œí•˜ë ¤ë©´, ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤

ansible-playbook -i inventory/mycluster/inventory.ini --become --become-user=root remove-node.yml --extra-vars "node=nodename,nodename2"

ì´ ëª…ë ¹ì–´ë¥¼ í†µí•´, í´ëŸ¬ìŠ¤í„°ì—ì„œ íŠ¹ì • ë…¸ë“œë¥¼ ì•ˆì „í•˜ê²Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚­ì œí•˜ë ¤ëŠ” ë…¸ë“œì˜ ì´ë¦„ì„Â `nodename`Â ë¶€ë¶„ì— ì…ë ¥í•´ì£¼ì„¸ìš”.

## ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œ LB Service ì‚¬ìš©ë°©ë²•

ê¸°ë³¸ì ìœ¼ë¡œ ë² ì–´ë©”íƒˆì—ì„œ LoadBalancer ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª‡ê°€ì§€ ë°©ë²•ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ì¤‘ ëŒ€í‘œì ìœ¼ë¡œÂ **MetalLB**Â ì„¤ì •ì„ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.

> **MetalLB?**
> 
> ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì¶• ì‹œ, í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œì™€ ê°™ì´ ë¯¸ë¦¬ ì¤€ë¹„ëœ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ì´ëŸ° ê²½ìš°ì— MetalLBëŠ” íš¨ê³¼ì ì¸ ëŒ€ì•ˆì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. MetalLBëŠ” Layer 2 (MAC ì£¼ì†Œ ê¸°ë°˜) ë˜ëŠ” Layer 3 (IP ì£¼ì†Œ ê¸°ë°˜)ì˜ ë„¤íŠ¸ì›Œí¬ ë°©ì‹ì„ í†µí•´ ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ì— ê³µì¸ IPë¥¼ ì œê³µí•¨ìœ¼ë¡œì¨ ë¡œë“œ ë°¸ëŸ°ì‹±ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.
> 
> ì´ëŸ¬í•œ ë°©ì‹ì€ í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì œê³µí•˜ëŠ” ë¡œë“œ ë°¸ëŸ°ì„œ ì„œë¹„ìŠ¤ì™€ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ ì‘ë™í•˜ë¯€ë¡œ, ì¿ ë²„ë„¤í‹°ìŠ¤ ì‚¬ìš©ìê°€ ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œë„ ì•ˆì •ì ì´ê³  ìœ ì—°í•œ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ì„ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.

### MetalLB ì¿ ë²„ë„¤í‹°ìŠ¤ Add-on ì„¤ì¹˜í•˜ê¸°

ì„¤ì¹˜í˜•ì„ í†µí•´ ì§ì ‘ ì„¤ì¹˜í•˜ëŠ” ë°©ì‹ê³¼ Kubesprayì—ì„œ ë¯¸ë¦¬ ì œê³µí•˜ê³  ìˆëŠ” add-on ë°©ì‹ ë‘ê°€ì§€ê°€ ìˆëŠ”ë°, ê¸°ë³¸ ì§€ì‹ì´ ì—†ë‹¤ë©´ add-onìœ¼ë¡œ ì„¤ì¹˜ í•˜ëŠ”ê²ƒì´ ê°„í¸í•©ë‹ˆë‹¤.

**Kubespray ansible add-on ì„¤ì •**

- íŒŒì¼ìœ„ì¹˜: `{ansible inventory}/mycluster/group_vars/addons.yml`

í•´ë‹¹ íŒŒì¼ ìœ„ì¹˜ì—ì„œ ì•„ë˜ metalLB ì˜µì…˜ ë¶€ë¶„ì„ í•´ì œí•œë’¤ í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ í•¨ê»˜ ë°°í¬ë©ë‹ˆë‹¤.

...  
# MetalLB deployment  
metallb_enabled: true # ì£¼ì„ í•´ì œ  
metallb_speaker_enabled: true # ì£¼ì„ í•´ì œ  
metallb_ip_range:  
  - 10.233.100.0/18 # ì£¼ì„ í•´ì œ ë° ë²”ìœ„ ìˆ˜ì •   
..

ì•„ë˜ëŠ” 4ëŒ€ì˜ ë² ì–´ë©”íƒˆë¡œ í´ëŸ¬ìŠ¤í„° êµ¬ì¶•ëœ ê²°ê³¼ì…ë‹ˆë‹¤.

![](https://miro.medium.com/v2/resize:fit:669/1*OhCwPxPoKBrOU3S3sMHjZQ.png)

[

K8s

](https://medium.com/tag/k8s?source=post_page-----b2f0e1be96dd---------------------------------------)

[

Kubernetes

](https://medium.com/tag/kubernetes?source=post_page-----b2f0e1be96dd---------------------------------------)

[

Kubespray

](https://medium.com/tag/kubespray?source=post_page-----b2f0e1be96dd---------------------------------------)

[

On Premise

](https://medium.com/tag/on-premise?source=post_page-----b2f0e1be96dd---------------------------------------)

[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb2f0e1be96dd&operation=register&redirect=https%3A%2F%2Fbluecheat.medium.com%2F%25EC%2598%25A8%25ED%2594%2584%25EB%25A0%2588%25EB%25AF%25B8%25EC%258A%25A4-%25ED%2599%2598%25EA%25B2%25BD%25EC%2597%2590%25EC%2584%259C-%25ED%2581%25B4%25EB%259D%25BC%25EC%259A%25B0%25EB%2593%259C-%25EC%2597%2586%25EC%259D%25B4-%25EC%25BF%25A0%25EB%25B2%2584%25EB%2584%25A4%25ED%258B%25B0%25EC%258A%25A4-%25EC%2584%25A4%25EC%25B9%2598%25ED%2595%2598%25EA%25B8%25B0-b2f0e1be96dd&source=---footer_actions--b2f0e1be96dd---------------------bookmark_footer----------------